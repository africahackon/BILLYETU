name: billyetu
services:
  - name: web
    environment_slug: php
    http_port: 8080
    instance_size_slug: basic-xxs

    build_command: |
      # Install PHP dependencies
      composer install --no-dev --optimize-autoloader

      # Optimize Laravel
      php artisan config:clear
      php artisan route:clear
      php artisan view:clear
      php artisan config:cache
      php artisan route:cache
      php artisan view:cache

      # Install Node dependencies and build assets
      npm ci
      npm run build

    run_command: |
      # Run migrations before starting
      php artisan migrate --force

      # Start PHP-FPM (DigitalOcean routes traffic through Nginx)
      php-fpm -F
