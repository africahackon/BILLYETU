import{r as M,u as B,s as V,w as J,c as K,o as i,a as p,d as t,b as o,t as d,g as D,i as r,l as y,k as R,v as Q,F as v,m as h,e as a,f as c,M as W,n as X,z as _}from"./app-B-oWgorL.js";import{_ as Y}from"./AuthenticatedLayout-DQmTMAKG.js";import{_ as F}from"./Modal-rL_D16Y4.js";import{_ as w}from"./InputLabel-Qc75SLBk.js";import{_ as Z}from"./TextInput-CHdG8hXy.js";import{_ as P}from"./TextArea-B-NnYSk7.js";import{P as S}from"./PrimaryButton-JAsWR8mt.js";import{D as A}from"./DangerButton-C9Y_aHkz.js";import{_ as T}from"./InputError-DjJ0vloF.js";import{_ as ee}from"./Pagination-DdDL4nx1.js";import"./useTheme-BqXCrGo_.js";import"./users-UbsQP_5p.js";import"./createLucideIcon-676DDOdB.js";import"./clock-Ceb6M1qm.js";import"./circle-check-big-BLJy3Tqw.js";import"./triangle-alert-BrKQhPAh.js";import"./dollar-sign-DBGEH5tI.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"flex justify-between items-center"},se={class:"my-4 flex items-center gap-4"},le={class:"bg-blue-50 border border-blue-200 rounded px-4 py-2 text-blue-800 font-semibold"},ne={class:"p-6 space-y-4"},oe={class:"mb-2 flex items-center gap-2"},ae={class:"mb-2 flex items-center gap-2"},ie=["checked"],de={class:"max-h-40 overflow-y-auto border rounded p-2 bg-gray-50"},re=["id","value","checked","onChange"],ue=["for"],me={key:0,class:"text-gray-400 text-sm"},pe={key:0,class:"mt-2 bg-blue-50 border border-blue-200 rounded p-2"},ce={class:"flex flex-wrap gap-2"},fe=["onClick"],xe=["value"],ge={class:"flex items-center gap-4"},be={key:0,class:"text-red-600"},ye={class:"flex justify-end gap-2"},ve={class:"my-8"},he={class:"flex justify-between items-center mb-2"},_e={class:"bg-white shadow rounded-lg overflow-x-auto"},we={class:"min-w-full divide-y divide-gray-200"},Se={class:"divide-y divide-gray-100"},ke={class:"px-4 py-2"},Ce={class:"px-4 py-2"},Me={class:"px-4 py-2 text-right flex gap-2 justify-end"},Ve={key:0},Te={class:"p-6 space-y-4"},$e={class:"text-lg font-semibold mb-2"},Ae={class:"flex justify-end gap-2"},Ne={class:"my-8"},je={class:"bg-white shadow rounded-lg overflow-x-auto"},Be={class:"min-w-full divide-y divide-gray-200"},De={class:"divide-y divide-gray-100"},Re={class:"px-4 py-2"},Fe={class:"px-4 py-2"},Pe={class:"px-4 py-2"},Ue={class:"px-4 py-2"},Le={class:"px-4 py-2"},Ee={class:"px-4 py-2"},ze={key:0},Ie=.01,it={__name:"Index",props:{messages:Object,balance:[Object,Number],subscribers:Array,templates:Array},setup(u){const k=u,g=M(!1),l=B({recipients:[],message:"",template_id:""}),U=V(()=>Math.round(l.message.length*Ie*100)),$=V(()=>U.value*l.recipients.length);J(()=>l.template_id,n=>{if(n){const e=k.templates.find(s=>s.id===n);e&&(l.message=e.content)}});function L(){l.reset(),g.value=!0}function E(){l.post(route("tenants.sms.store"),{onSuccess:()=>{g.value=!1,l.reset(),_.reload({only:["messages","balance"]})}})}const f=M(!1),C=M(null),m=B({name:"",content:""});function N(n=null){C.value=n?n.id:null,m.name=n?n.name:"",m.content=n?n.content:"",f.value=!0}function z(){C.value?m.put(route("tenants.sms-templates.update",C.value),{onSuccess:()=>{f.value=!1,m.reset(),_.reload({only:["templates"]})}}):m.post(route("tenants.sms-templates.store"),{onSuccess:()=>{f.value=!1,m.reset(),_.reload({only:["templates"]})}})}function I(n){confirm("Delete this template?")&&_.delete(route("tenants.sms-templates.destroy",n),{onSuccess:()=>_.reload({only:["templates"]})})}const O={sent:"bg-green-100 text-green-700",pending:"bg-yellow-100 text-yellow-700",failed:"bg-red-100 text-red-700"},b=M(""),x=V(()=>b.value?k.subscribers.filter(n=>n.full_name.toLowerCase().includes(b.value.toLowerCase())||n.phone.includes(b.value)):k.subscribers),j=V({get(){return x.value.length>0&&x.value.every(n=>l.recipients.includes(n.phone))},set(n){if(n){const e=x.value.map(s=>s.phone);l.recipients=Array.from(new Set([...l.recipients,...e]))}else l.recipients=l.recipients.filter(e=>!x.value.some(s=>s.phone===e))}});function H(n){l.recipients.includes(n)?l.recipients=l.recipients.filter(e=>e!==n):l.recipients.push(n)}function q(n){l.recipients=l.recipients.filter(e=>e!==n)}return(n,e)=>(i(),K(Y,null,{header:p(()=>[t("div",te,[e[12]||(e[12]=t("h2",{class:"text-2xl font-semibold text-gray-800"},"SMS Management",-1)),o(S,{onClick:L},{default:p(()=>[...e[11]||(e[11]=[c("Send SMS",-1)])]),_:1})])]),default:p(()=>[t("div",se,[t("div",le," SMS Balance: "+d(u.balance?.balance??0),1)]),o(F,{show:g.value,onClose:e[5]||(e[5]=s=>g.value=!1)},{default:p(()=>[t("div",ne,[e[20]||(e[20]=t("h3",{class:"text-lg font-semibold mb-2"},"Compose SMS",-1)),t("form",{onSubmit:D(E,["prevent"]),class:"space-y-4"},[t("div",null,[o(w,{value:"Recipients"}),t("div",oe,[R(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s),placeholder:"Search recipients...",class:"border rounded px-2 py-1 w-full"},null,512),[[Q,b.value]])]),t("div",ae,[t("input",{type:"checkbox",checked:j.value,onChange:e[1]||(e[1]=s=>j.value=s.target.checked),id:"selectAllRecipients"},null,40,ie),e[13]||(e[13]=t("label",{for:"selectAllRecipients",class:"text-sm"},"Select All",-1))]),t("div",de,[(i(!0),r(v,null,h(x.value,s=>(i(),r("div",{key:s.id,class:"flex items-center gap-2 mb-1"},[t("input",{type:"checkbox",id:"recipient-"+s.id,value:s.phone,checked:a(l).recipients.includes(s.phone),onChange:()=>H(s.phone)},null,40,re),t("label",{for:"recipient-"+s.id},d(s.full_name)+" ("+d(s.phone)+")",9,ue)]))),128)),x.value.length?y("",!0):(i(),r("div",me,"No recipients found."))]),o(T,{message:a(l).errors.recipients},null,8,["message"]),a(l).recipients.length?(i(),r("div",pe,[e[14]||(e[14]=t("div",{class:"font-semibold text-blue-800 mb-1 text-sm"},"Selected Recipients:",-1)),t("div",ce,[(i(!0),r(v,null,h(a(l).recipients,s=>(i(),r("span",{key:s,class:"bg-blue-100 text-blue-800 px-2 py-1 rounded flex items-center gap-1"},[c(d(k.subscribers.find(G=>G.phone===s)?.full_name||s)+" ",1),t("button",{type:"button",onClick:()=>q(s),class:"ml-1 text-blue-600 hover:text-red-600"},"×",8,fe)]))),128))])])):y("",!0)]),t("div",null,[o(w,{value:"Template (optional)"}),R(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>a(l).template_id=s),class:"w-full border rounded"},[e[15]||(e[15]=t("option",{value:""},"-- Select Template --",-1)),(i(!0),r(v,null,h(u.templates,s=>(i(),r("option",{key:s.id,value:s.id},d(s.name),9,xe))),128))],512),[[W,a(l).template_id]])]),t("div",null,[o(w,{value:"Message"}),o(P,{modelValue:a(l).message,"onUpdate:modelValue":e[3]||(e[3]=s=>a(l).message=s),rows:"4",class:"w-full"},null,8,["modelValue"]),o(T,{message:a(l).errors.message},null,8,["message"])]),t("div",ge,[t("span",null,[e[16]||(e[16]=c("Cost: ",-1)),t("b",null,d($.value),1),e[17]||(e[17]=c(" cents",-1))]),u.balance&&$.value>u.balance.balance?(i(),r("span",be,"Insufficient balance")):y("",!0)]),t("div",ye,[o(A,{onClick:e[4]||(e[4]=s=>g.value=!1),type:"button"},{default:p(()=>[...e[18]||(e[18]=[c("Cancel",-1)])]),_:1}),o(S,{disabled:a(l).processing||u.balance&&$.value>u.balance.balance},{default:p(()=>[...e[19]||(e[19]=[c(" Send ",-1)])]),_:1},8,["disabled"])])],32)])]),_:1},8,["show"]),t("div",ve,[t("div",he,[e[22]||(e[22]=t("h3",{class:"text-lg font-semibold"},"SMS Templates",-1)),o(S,{onClick:e[6]||(e[6]=()=>N())},{default:p(()=>[...e[21]||(e[21]=[c("Add Template",-1)])]),_:1})]),t("div",_e,[t("table",we,[e[26]||(e[26]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left text-xs font-semibold text-gray-600"},"Name"),t("th",{class:"px-4 py-2 text-left text-xs font-semibold text-gray-600"},"Content"),t("th",{class:"px-4 py-2 text-right text-xs font-semibold text-gray-600"},"Actions")])],-1)),t("tbody",Se,[(i(!0),r(v,null,h(u.templates,s=>(i(),r("tr",{key:s.id},[t("td",ke,d(s.name),1),t("td",Ce,d(s.content),1),t("td",Me,[o(S,{onClick:()=>N(s)},{default:p(()=>[...e[23]||(e[23]=[c("Edit",-1)])]),_:1},8,["onClick"]),o(A,{onClick:()=>I(s.id)},{default:p(()=>[...e[24]||(e[24]=[c("Delete",-1)])]),_:1},8,["onClick"])])]))),128)),u.templates&&u.templates.length?y("",!0):(i(),r("tr",Ve,[...e[25]||(e[25]=[t("td",{colspan:"3",class:"text-center text-gray-500 py-6"},"No templates found.",-1)])]))])])])]),o(F,{show:f.value,onClose:e[10]||(e[10]=s=>f.value=!1)},{default:p(()=>[t("div",Te,[t("h3",$e,d(C.value?"Edit":"Add")+" Template",1),t("form",{onSubmit:D(z,["prevent"]),class:"space-y-4"},[t("div",null,[o(w,{value:"Name"}),o(Z,{modelValue:a(m).name,"onUpdate:modelValue":e[7]||(e[7]=s=>a(m).name=s),class:"w-full"},null,8,["modelValue"]),o(T,{message:a(m).errors.name},null,8,["message"])]),t("div",null,[o(w,{value:"Content"}),o(P,{modelValue:a(m).content,"onUpdate:modelValue":e[8]||(e[8]=s=>a(m).content=s),rows:"4",class:"w-full"},null,8,["modelValue"]),o(T,{message:a(m).errors.content},null,8,["message"])]),t("div",Ae,[o(A,{onClick:e[9]||(e[9]=s=>f.value=!1),type:"button"},{default:p(()=>[...e[27]||(e[27]=[c("Cancel",-1)])]),_:1}),o(S,{disabled:a(m).processing},{default:p(()=>[...e[28]||(e[28]=[c("Save",-1)])]),_:1},8,["disabled"])])],32)])]),_:1},8,["show"]),t("div",Ne,[e[31]||(e[31]=t("h3",{class:"text-lg font-semibold mb-2"},"SMS History",-1)),t("div",je,[t("table",Be,[e[30]||(e[30]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left text-xs font-semibold text-gray-600"},"Recipient"),t("th",{class:"px-4 py-2 text-left text-xs font-semibold text-gray-600"},"Phone"),t("th",{class:"px-4 py-2 text-left text-xs font-semibold text-gray-600"},"Message"),t("th",{class:"px-4 py-2 text-left text-xs font-semibold text-gray-600"},"Status"),t("th",{class:"px-4 py-2 text-left text-xs font-semibold text-gray-600"},"Cost"),t("th",{class:"px-4 py-2 text-left text-xs font-semibold text-gray-600"},"Sent At")])],-1)),t("tbody",De,[(i(!0),r(v,null,h(u.messages.data,s=>(i(),r("tr",{key:s.id},[t("td",Re,d(s.recipient),1),t("td",Fe,d(s.recipient_phone),1),t("td",Pe,d(s.message),1),t("td",Ue,[t("span",{class:X(["inline-block px-2 py-1 rounded text-xs font-semibold",O[s.status]||"bg-gray-100 text-gray-700"])},d(s.status),3)]),t("td",Le,d(s.cost),1),t("td",Ee,d(s.sent_at?new Date(s.sent_at).toLocaleString():"—"),1)]))),128)),u.messages.data&&u.messages.data.length?y("",!0):(i(),r("tr",ze,[...e[29]||(e[29]=[t("td",{colspan:"6",class:"text-center text-gray-500 py-6"},"No messages found.",-1)])]))])]),o(ee,{class:"mt-4",links:u.messages.links},null,8,["links"])])])]),_:1}))}};export{it as default};
