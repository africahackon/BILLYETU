import{r as c,u as Y,w as T,s as P,c as Z,o as p,a,i as f,l as D,d as t,b as o,t as r,f as u,n as A,k as g,y as B,F as N,m as z,e as n,M as S,z as V}from"./app-DQ1vlaC4.js";import{_ as ee}from"./AuthenticatedLayout-CTmlqVjy.js";import{_ as U}from"./Modal-DFnkkLC8.js";import{_ as b}from"./InputLabel-C7E4CK2O.js";import{_ as R}from"./TextArea-CFlcxSYQ.js";import{_}from"./InputError-fFqqaa-Z.js";import{_ as te}from"./Pagination-YzUkO9ST.js";import{P as k}from"./PrimaryButton-COi-B1G3.js";import{D as F}from"./DangerButton-DgYQaF_6.js";import{C as se}from"./check-DpbPLkAY.js";import{S as le}from"./square-pen-v0UkBWV9.js";import{T as oe}from"./trash-2-CHZDhFqJ.js";import{S as E}from"./save-55dioA10.js";import{X as ne}from"./x-CsMTUfFl.js";import{P as ie}from"./plus-Dr2sUzT-.js";import"./useTheme-CZQL-PUu.js";import"./users-DRAMVCud.js";import"./createLucideIcon-B_z4RiSM.js";import"./clock-BGYHf9J1.js";import"./circle-check-big-DsdPW5IB.js";import"./triangle-alert-k_4De6-w.js";import"./dollar-sign-D5yBrcRU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"flex justify-between items-center"},re={class:"text-xl font-bold"},de={key:0,class:"mb-4 flex items-center justify-between bg-yellow-50 p-3 border border-yellow-200 rounded"},ue={class:"text-sm text-yellow-800 font-medium"},pe={class:"flex gap-2"},me={class:"mt-4 flex gap-2"},ve={class:"mt-6 bg-white shadow rounded-lg overflow-x-auto"},ce={class:"min-w-full divide-y divide-gray-200"},fe={class:"bg-gray-50"},ye={class:"px-4 py-3"},xe={class:"divide-y divide-gray-100"},ge={class:"px-6 py-3"},be=["value"],_e={class:"px-4 py-2 font-mono text-blue-600"},ke={class:"px-4 py-2"},we={class:"px-4 py-2 capitalize"},Ce={class:"px-4 py-2 capitalize"},he={class:"px-4 py-2 capitalize"},$e={class:"px-4 py-2"},Se=["onClick"],Ve={class:"px-4 py-2 text-right flex gap-2 justify-end"},Te=["onClick"],De=["onClick"],Ue=["onClick"],Fe={key:0},je={class:"p-6 space-y-4"},Me={class:"flex justify-end gap-2"},Pe={class:"p-6 space-y-4"},Ae={class:"text-lg font-semibold"},Be=["value"],Ne={class:"flex justify-end gap-3 mt-4"},ze={class:"p-6"},Re={class:"text-gray-700"},Ee={class:"mt-4 text-right"},ut={__name:"Index",props:{tickets:Object,statusFilter:String,users:Array,leads:Array},setup(C){const m=C,v=c(!1),y=c(null),d=c([]),x=c(null),h=c(!1),j=c(""),l=Y({client_type:"user",client_id:"",priority:"medium",status:"open",description:"",resolution_note:""}),L=()=>{y.value=null,l.reset(),l.status="open",l.priority="medium",v.value=!0},O=i=>{y.value=i.id,l.client_type=i.client_type,l.client_id=i.client_id,l.priority=i.priority,l.status=i.status,l.description=i.description,v.value=!0},I=()=>{y.value?l.put(route("tenants.tickets.update",y.value),{onSuccess:()=>v.value=!1}):l.post(route("tenants.tickets.store"),{onSuccess:()=>v.value=!1})},q=i=>{x.value=i.id,l.resolution_note=""},H=()=>{l.put(route("tenants.tickets.resolve",x.value),{onSuccess:()=>{x.value=null,l.resolution_note=""}})};T(()=>l.client_type,()=>{l.client_id=""});const $=c(!1);T($,i=>{i?d.value=m.tickets.data.map(e=>e.id):d.value=[]});const W=P(()=>m.tickets.data.map(i=>i.id));T(d,i=>{$.value=i.length===W.value.length});const X=i=>{confirm("Delete this ticket?")&&V.delete(route("tenants.tickets.destroy",i))},M=i=>{V.visit(route("tenants.tickets.index",{status:i}),{preserveScroll:!0})},G=P(()=>l.client_type==="user"?m.users:m.leads),J=()=>{d.value.length&&confirm("Are you sure you want to delete selected Tickets?")&&V.delete(route("tenants.tickets.bulk-delete"),{data:{ids:d.value},onSuccess:()=>{d.value=[],V.visit(route("tenants.tickets.index"),{preserveScroll:!0})}})};function K(i,e=2){if(!i)return"";const s=i.split(" ");return s.length>e?s.slice(0,e).join(" ")+"…":i}function Q(i){j.value=i,h.value=!0}return(i,e)=>(p(),Z(ee,null,{header:a(()=>[t("div",ae,[t("h2",re,"Tickets ("+r(m.statusFilter)+")",1),o(k,{onClick:L,class:"flex items-center gap-2"},{default:a(()=>[o(n(ie),{class:"w-4 h-4"}),e[16]||(e[16]=u(" Add Ticket ",-1))]),_:1})])]),default:a(()=>[d.value.length?(p(),f("div",de,[t("span",ue,r(d.value.length)+" selected",1),t("div",pe,[o(F,{onClick:J},{default:a(()=>[u("Delete ("+r(d.value.length)+")",1)]),_:1})])])):D("",!0),t("div",me,[o(k,{onClick:e[0]||(e[0]=s=>M("open")),class:A({"bg-blue-700":m.statusFilter==="open"})},{default:a(()=>[...e[17]||(e[17]=[u(" Open ",-1)])]),_:1},8,["class"]),o(k,{onClick:e[1]||(e[1]=s=>M("closed")),class:A({"bg-blue-700":m.statusFilter==="closed"})},{default:a(()=>[...e[18]||(e[18]=[u(" Closed ",-1)])]),_:1},8,["class"])]),t("div",ve,[t("table",ce,[t("thead",fe,[t("tr",null,[t("td",ye,[g(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=s=>$.value=s)},null,512),[[B,$.value]])]),e[19]||(e[19]=t("th",{class:"px-4 py-2 text-left text-xs font-semibold text-gray-600"},"Ticket #",-1)),e[20]||(e[20]=t("th",{class:"px-4 py-2 text-left text-xs font-semibold text-gray-600"},"Client",-1)),e[21]||(e[21]=t("th",{class:"px-4 py-2 text-left text-xs font-semibold text-gray-600"},"Type",-1)),e[22]||(e[22]=t("th",{class:"px-4 py-2 text-left text-xs font-semibold text-gray-600"},"Priority",-1)),e[23]||(e[23]=t("th",{class:"px-4 py-2 text-left text-xs font-semibold text-gray-600"},"Status",-1)),e[24]||(e[24]=t("th",{class:"px-4 py-2 text-left text-xs font-semibold text-gray-600"},"Description",-1)),e[25]||(e[25]=t("th",{class:"px-4 py-2 text-right text-xs font-semibold text-gray-600"},"Actions",-1))])]),t("tbody",xe,[(p(!0),f(N,null,z(C.tickets.data,s=>(p(),f("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",ge,[g(t("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":e[3]||(e[3]=w=>d.value=w)},null,8,be),[[B,d.value]])]),t("td",_e,r(s.ticket_number),1),t("td",ke,r(s.client?.full_name||s.client?.name||"—"),1),t("td",we,r(s.client_type),1),t("td",Ce,r(s.priority),1),t("td",he,r(s.status),1),t("td",$e,[t("span",{onClick:w=>Q(s.description),class:"cursor-pointer text-green-600 hover:underline"},r(K(s.description,1)),9,Se)]),t("td",Ve,[s.status==="open"?(p(),f("button",{key:0,onClick:w=>q(s),class:"text-green-600 hover:underline"},[o(n(se),{class:"w-4 h-4"})],8,Te)):D("",!0),t("button",{onClick:w=>O(s),class:"text-blue-600 hover:underline"},[o(n(le),{class:"w-4 h-4"})],8,De),t("button",{onClick:w=>X(s.id),class:"text-red-600 hover:underline"},[o(n(oe),{class:"w-4 h-4"})],8,Ue)])]))),128)),C.tickets.data.length===0?(p(),f("tr",Fe,[...e[26]||(e[26]=[t("td",{colspan:"7",class:"text-center text-sm text-gray-500 py-6"},"No tickets found.",-1)])])):D("",!0)])])]),o(te,{links:C.tickets.links,class:"mt-6"},null,8,["links"]),o(U,{show:!!x.value,onClose:e[6]||(e[6]=s=>x.value=null)},{default:a(()=>[t("div",je,[e[29]||(e[29]=t("h2",{class:"text-lg font-semibold"},"Resolve Ticket",-1)),t("div",null,[o(b,{value:"Resolution Note"}),o(R,{modelValue:n(l).resolution_note,"onUpdate:modelValue":e[4]||(e[4]=s=>n(l).resolution_note=s),rows:"4",class:"w-full"},null,8,["modelValue"]),o(_,{message:n(l).errors.resolution_note},null,8,["message"])]),t("div",Me,[o(F,{onClick:e[5]||(e[5]=s=>x.value=null)},{default:a(()=>[...e[27]||(e[27]=[u("Cancel",-1)])]),_:1}),o(k,{onClick:H,disabled:n(l).processing},{default:a(()=>[o(n(E),{class:"w-4 h-4 mr-1"}),e[28]||(e[28]=u(" Mark as Resolved ",-1))]),_:1},8,["disabled"])])])]),_:1},8,["show"]),o(U,{show:v.value,onClose:e[13]||(e[13]=s=>v.value=!1)},{default:a(()=>[t("div",Pe,[t("h2",Ae,r(y.value?"Edit Ticket":"Create Ticket"),1),t("div",null,[o(b,{value:"Client Type"}),g(t("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>n(l).client_type=s),class:"mt-1 block w-full border-gray-300 rounded-md"},[...e[30]||(e[30]=[t("option",{value:"user"},"User",-1),t("option",{value:"lead"},"Lead",-1)])],512),[[S,n(l).client_type]]),o(_,{message:n(l).errors.client_type},null,8,["message"])]),t("div",null,[o(b,{value:"Client"}),g(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>n(l).client_id=s),class:"mt-1 block w-full border-gray-300 rounded-md"},[e[31]||(e[31]=t("option",{disabled:"",value:""},"Select Client",-1)),(p(!0),f(N,null,z(G.value,s=>(p(),f("option",{key:s.id,value:s.id},r(s.full_name||s.name),9,Be))),128))],512),[[S,n(l).client_id]]),o(_,{message:n(l).errors.client_id},null,8,["message"])]),t("div",null,[o(b,{value:"Priority"}),g(t("select",{"onUpdate:modelValue":e[9]||(e[9]=s=>n(l).priority=s),class:"mt-1 block w-full border-gray-300 rounded-md"},[...e[32]||(e[32]=[t("option",{value:"low"},"Low",-1),t("option",{value:"medium"},"Medium",-1),t("option",{value:"high"},"High",-1)])],512),[[S,n(l).priority]]),o(_,{message:n(l).errors.priority},null,8,["message"])]),t("div",null,[o(b,{value:"Status"}),g(t("select",{"onUpdate:modelValue":e[10]||(e[10]=s=>n(l).status=s),class:"mt-1 block w-full border-gray-300 rounded-md"},[...e[33]||(e[33]=[t("option",{value:"open"},"Open",-1),t("option",{value:"closed"},"Closed",-1)])],512),[[S,n(l).status]]),o(_,{message:n(l).errors.status},null,8,["message"])]),t("div",null,[o(b,{value:"Description"}),o(R,{modelValue:n(l).description,"onUpdate:modelValue":e[11]||(e[11]=s=>n(l).description=s),class:"mt-1 block w-full",rows:"3"},null,8,["modelValue"]),o(_,{message:n(l).errors.description},null,8,["message"])]),t("div",Ne,[o(F,{type:"button",onClick:e[12]||(e[12]=s=>v.value=!1)},{default:a(()=>[o(n(ne),{class:"w-4 h-4 mr-1"}),e[34]||(e[34]=u(" Cancel ",-1))]),_:1}),o(k,{disabled:n(l).processing,onClick:I},{default:a(()=>[o(n(E),{class:"w-4 h-4 mr-1"}),u(" "+r(y.value?"Update":"Save"),1)]),_:1},8,["disabled"])])])]),_:1},8,["show"]),o(U,{show:h.value,onClose:e[15]||(e[15]=s=>h.value=!1)},{default:a(()=>[t("div",ze,[e[36]||(e[36]=t("h2",{class:"text-lg font-semibold mb-4"},"Description",-1)),t("p",Re,r(j.value),1),t("div",Ee,[o(k,{onClick:e[14]||(e[14]=s=>h.value=!1)},{default:a(()=>[...e[35]||(e[35]=[u("Close",-1)])]),_:1})])])]),_:1},8,["show"])]),_:1}))}};export{ut as default};
