import{r as c,J as P,c as I,o as d,a as n,d as t,f as o,b as p,t as v,i as x,l as g,z as C}from"./app-DQ1vlaC4.js";import{_ as A}from"./AuthenticatedLayout-CTmlqVjy.js";import{P as m}from"./PrimaryButton-COi-B1G3.js";import"./useTheme-CZQL-PUu.js";import"./users-DRAMVCud.js";import"./createLucideIcon-B_z4RiSM.js";import"./clock-BGYHf9J1.js";import"./circle-check-big-DsdPW5IB.js";import"./triangle-alert-k_4De6-w.js";import"./dollar-sign-D5yBrcRU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"max-w-3xl mx-auto py-8"},B={class:"bg-white shadow rounded p-6"},N={class:"flex gap-2 mb-4"},O={class:"bg-gray-900 text-green-200 rounded p-4 overflow-x-auto text-xs mb-6",style:{"min-height":"300px"}},U={class:"flex gap-2 mb-4"},E={key:0,class:"flex items-center gap-2 text-blue-600"},V={key:1,class:"text-green-600 font-semibold"},j={key:2,class:"text-red-600"},W={class:"flex justify-end"},G={__name:"SetupScript",props:{router:Object,script:String},setup(h){const l=h,b=c(!1);function y(){navigator.clipboard.writeText(l.script),b.value=!0,setTimeout(()=>b.value=!1,2e3)}function k(){const s=new Blob([l.script],{type:"text/plain"}),e=URL.createObjectURL(s),f=document.createElement("a");f.href=e,f.download=`setup_router_${l.router.id}.rsc`,f.click(),URL.revokeObjectURL(e)}const r=c(!1),i=c(!1),a=c("");let u=null;function S(){r.value=!0,a.value="",u=setInterval(()=>{fetch(route("tenants.mikrotiks.ping",l.router.id)).then(s=>s.json()).then(s=>{s.status==="online"&&(i.value=!0,r.value=!1,clearInterval(u))}).catch(()=>{a.value="Error checking router status."})},5e3)}function w(){u&&clearInterval(u)}P(()=>{w()});function _(){C.visit(route("tenants.mikrotiks.index"))}return(s,e)=>(d(),I(A,null,{header:n(()=>[...e[0]||(e[0]=[t("h2",{class:"text-2xl font-semibold text-gray-800"},"Mikrotik System Onboarding Script",-1)])]),default:n(()=>[t("div",R,[t("div",B,[e[5]||(e[5]=t("p",{class:"mb-4 text-gray-700"},[t("b",null,"Step 1:"),o(" Copy or download the script below and run it in your Mikrotik terminal (Winbox, WebFig, or SSH)."),t("br"),t("b",null,"Step 2:"),o(" After running the script, copy the IP address shown in the output and paste it into the system to complete onboarding."),t("br"),t("b",null,"Step 3:"),o(" Click "),t("b",null,"I've run the script"),o(" to begin checking if your router is online. Once detected, you can continue. ")],-1)),e[6]||(e[6]=t("div",{class:"mb-4 p-4 bg-blue-50 border-l-4 border-blue-400 text-blue-900 rounded"},[t("b",null,"What does this script do?"),t("ul",{class:"list-disc ml-6 mt-2 text-sm"},[t("li",null,"Sets the router's identity (name)"),t("li",null,"Prints all current IP addresses for onboarding"),t("li",null,"Enables API and adds a system API user"),t("li",null,"Restricts API/Winbox/SSH to trusted IPs (edit as needed)"),t("li",null,"Enables OVPN server and RADIUS authentication for PPP, Hotspot, and OVPN"),t("li",null,"Adds a RADIUS client for full system authentication"),t("li",null,[o("Adds a "),t("b",null,"disconnect-user"),o(" script for remote user management")]),t("li",null,[o("Adds a "),t("b",null,"health-check"),o(" scheduler for system monitoring")]),t("li",null,"Follows best security and automation practices")])],-1)),t("div",N,[p(m,{onClick:y},{default:n(()=>[o(v(b.value?"Copied!":"Copy Script"),1)]),_:1}),p(m,{onClick:k},{default:n(()=>[...e[1]||(e[1]=[o("Download Script",-1)])]),_:1})]),t("pre",O,""+v(h.script)+`
        `,1),t("div",U,[p(m,{onClick:S,disabled:r.value||i.value},{default:n(()=>[...e[2]||(e[2]=[o("I've run the script",-1)])]),_:1},8,["disabled"]),r.value?(d(),x("span",E,[...e[3]||(e[3]=[t("svg",{class:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})],-1),o("Waiting for router to come online...",-1)])])):g("",!0),i.value?(d(),x("span",V,"Router is online! You can continue.")):g("",!0),a.value?(d(),x("span",j,v(a.value),1)):g("",!0)]),t("div",W,[p(m,{onClick:_,disabled:!i.value},{default:n(()=>[...e[4]||(e[4]=[o("Next",-1)])]),_:1},8,["disabled"])])])])]),_:1}))}};export{G as default};
