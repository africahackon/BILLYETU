import{q as I,r as d,w as q,s as P,c as V,o as l,a as A,d as e,i as o,l as y,b as R,t as n,e as r,k as m,x as X,g as N,v as L,F as w,m as k,y as B,f as G,z as p,u as J}from"./app-B-oWgorL.js";import{_ as O}from"./SuperAdminLayout-DG1wZFbt.js";import{_ as Q}from"./Modal-rL_D16Y4.js";import{C as W}from"./circle-check-big-BLJy3Tqw.js";import{c as Y}from"./createLucideIcon-676DDOdB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./users-UbsQP_5p.js";import"./dollar-sign-DBGEH5tI.js";import"./credit-card-IF_RFLa3.js";/**
 * @license lucide-vue-next v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=Y("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),ee={class:"p-6 space-y-6"},se={class:"flex justify-between items-center"},te={class:"bg-blue-100 text-green-800 px-3 py-1 rounded text-sm font-mono"},le={key:0,class:"text-green-600"},oe={class:"flex items-center gap-2 mt-4"},ne=["onKeydown"],ae={class:"flex justify-end"},re={class:"p-4 space-y-4"},ie={key:0,class:"space-y-1"},de={class:"font-semibold"},ue={class:"max-h-32 overflow-y-auto border rounded p-2 bg-green-200 flex flex-wrap gap-2"},ce={class:"space-y-2"},pe={class:"border rounded max-h-40 overflow-y-auto bg-green-200 p-2 shadow-inner"},ve={class:"space-y-1"},xe={class:"flex items-center gap-2 mb-2"},me={class:"text-sm"},he=["value"],fe={class:"ml-2 truncate"},ye={key:0,class:"text-red-600 text-sm mt-1"},be={class:"text-right"},ge={key:1,class:"space-y-4"},_e={class:"flex justify-between items-center"},we=["disabled"],ke={class:"overflow-x-auto"},Se={class:"min-w-full border border-x-green-900 border-yellow-500 bg-gradient-to-r from-cyan-100 to-purple-100 text-sm"},Ce={class:"bg-green-200"},Me={class:"px-3 py-2 text-left"},Ue=["checked"],Ve={class:"px-3 py-2"},Le=["value"],Be={class:"px-3 py-2 whitespace-nowrap"},De={class:"text-gray-600 text-xs"},Fe=["title"],$e={class:"px-3 py-2 capitalize flex items-center gap-1"},qe={key:2,class:"w-4 h-4 text-yellow-500 animate-pulse",fill:"currentColor",viewBox:"0 0 20 20"},Ae={class:"text-sm"},Ne={class:"px-3 py-2"},je={class:"px-3 py-2"},ze={class:"px-3 py-2"},Te=["onClick"],Ke={key:0,class:"mt-4"},Ee={class:"flex flex-wrap gap-2"},He=["innerHTML","onClick","disabled"],Ie={key:2,class:"text-gray-600"},es={__name:"Index",setup(Pe){const{props:v}=I(),D=v.users||[],b=v.smsList?.data||[],F=v.smsList?.links||[],$=v.flash||{},j=v.balance?.balance??"Unknown",h=d({...v.filters}),f=d("");d(!1);const i=d([]),S=d(!1),x=d(!1),c=d([]),C=d(""),g=d(!1);q(g,a=>{a?i.value=_.value.map(s=>s.phone):i.value=[]}),q(i,a=>{const s=_.value.map(t=>t.phone);g.value=a.length===s.length&&s.length>0});const _=P(()=>{const a=C.value.toLowerCase();return D.filter(s=>s.name.toLowerCase().includes(a)||s.phone.toLowerCase().includes(a))}),z=()=>{h.value.search="",M()},M=()=>{p.get(route("admin.sms.index"),h.value,{preserveState:!1,preserveScroll:!0,replace:!0})},U=d(!1),T=()=>{if(U.value=!1,!f.value.trim()){U.value=!0;return}S.value=!0,J({message:f.value,recipients:i.value}).post(route("admin.sms.send"),{onFinish:()=>{S.value=!1,f.value="",i.value=[],x.value=!1,p.visit(route("admin.sms.index"),{preserveScroll:!0,preserveState:!1})}})},K=(a,s=2)=>a?a.trim().split(/\s+/).lents>s?s.slice(0,s).join(" ")+"...":a:"",E=a=>{confirm("Are you sure you want to delete this message?")&&p.delete(route("admin.sms.destroy",a),{onSuccess:()=>{p.visit(route("admin.sms.index"),{preserveScroll:!0,preserveState:!1})}})},H=()=>{c.value.length&&confirm("Delete selected messages?")&&p.delete(route("admin.sms.bulk-destroy"),{data:{ids:c.value},onSuccess:()=>{c.value=[],p.visit(route("admin.sms.index"),{preserveScroll:!0,preserveState:!1})}})};return(a,s)=>(l(),V(O,null,{default:A(()=>[e("div",ee,[e("div",se,[s[9]||(s[9]=e("h1",{class:"text-2xl font-bold"},"SMS Messages",-1)),e("span",te,"Balance: "+n(r(j)),1)]),r($).success?(l(),o("div",le,n(r($).success),1)):y("",!0),e("div",oe,[m(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>h.value.search=t),onKeydown:X(N(M,["prevent"]),["enter"]),placeholder:"Search by name or phone...",class:"border rounded px-2 py-2 max-w-xs"},null,40,ne),[[L,h.value.search]]),e("button",{onClick:M,class:"bg-blue-600 text-white px-3 py-2 rounded"}," Search "),h.value.search?(l(),o("button",{key:0,onClick:z,class:"text-gray-500 text-sm hover:text-red-600"}," Clear ")):y("",!0)]),e("div",ae,[e("button",{onClick:s[1]||(s[1]=t=>x.value=!x.value),class:"bg-green-700 text-white hover:text-blue-900 hover:bg-green-400 px-4 py-2 rounded"},n(x.value?"Close":"Send SMS"),1)]),R(Q,{show:x.value,onClose:s[6]||(s[6]=t=>x.value=!1)},{default:A(()=>[e("div",re,[s[12]||(s[12]=e("h2",{class:"text-lg font-semibold"},"Create SMS",-1)),i.value.length?(l(),o("div",ie,[e("h3",de,"Selected Users ("+n(i.value.length)+"):",1),e("div",ue,[(l(!0),o(w,null,k(i.value,t=>(l(),o("span",{key:t,class:"bg-yellow-300 px-2 py-1 rounded text-sm whitespace-nowrap"},n(r(D).find(u=>u.phone===t)?.name||"Unknown")+" ("+n(t)+") ",1))),128))])])):y("",!0),e("div",ce,[s[10]||(s[10]=e("label",{class:"block font-semibold"},"Search Users",-1)),m(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>C.value=t),type:"text",placeholder:"Search by name or phone...",class:"border rounded px-3 py-2 w-full max-w-md"},null,512),[[L,C.value]]),e("div",pe,[e("ul",ve,[e("div",xe,[m(e("input",{type:"checkbox","onUpdate:modelValue":s[3]||(s[3]=t=>g.value=t),class:"form-checkbox text-green-700"},null,512),[[B,g.value]]),e("label",me,"Select All ("+n(_.value.length)+")",1)]),(l(!0),o(w,null,k(_.value,t=>(l(),o("li",{key:t.id,class:"flex items-center"},[m(e("input",{type:"checkbox",value:t.phone,"onUpdate:modelValue":s[4]||(s[4]=u=>i.value=u),class:"form-checkbox text-green-900"},null,8,he),[[B,i.value]]),e("span",fe,n(t.name)+" â€” "+n(t.phone),1)]))),128))])])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block mb-1 font-semibold"},"Message",-1)),m(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=t=>f.value=t),rows:"4",required:"",class:"w-full border bg-green-100 p-2 rounded"},null,512),[[L,f.value]]),U.value?(l(),o("p",ye,"Message is required.")):y("",!0)]),e("div",be,[e("button",{onClick:T,class:"bg-green-900 text-white px-4 py-2 rounded shadow"},n(S.value?"Sending...":"Send SMS"),1)])])]),_:1},8,["show"]),r(b).length?(l(),o("div",ge,[e("div",_e,[s[13]||(s[13]=e("h2",{class:"text-lg font-semibold"},"Sent Messages",-1)),e("button",{onClick:H,disabled:!c.value.length,class:"bg-red-600 text-white px-3 py-1 rounded disabled:opacity-50"}," Delete Selected ",8,we)]),e("div",ke,[e("table",Se,[e("thead",Ce,[e("tr",null,[e("th",Me,[e("input",{type:"checkbox",checked:c.value.length===r(b).length,onChange:s[7]||(s[7]=t=>c.value=t.target.checked?r(b).map(u=>u.id):[])},null,40,Ue)]),s[14]||(s[14]=e("th",{class:"px-3 py-2 text-left"},"Recipient",-1)),s[15]||(s[15]=e("th",{class:"px-3 py-2 text-left"},"Message",-1)),s[16]||(s[16]=e("th",{class:"px-3 py-2 text-left"},"Status",-1)),s[17]||(s[17]=e("th",{class:"px-3 py-2 text-left"},"Sent By",-1)),s[18]||(s[18]=e("th",{class:"px-3 py-2 text-left"},"Sent At",-1)),s[19]||(s[19]=e("th",{class:"px-3 py-2 text-left"},"Actions",-1))])]),e("tbody",null,[(l(!0),o(w,null,k(r(b),t=>(l(),o("tr",{key:t.id,class:"border-t"},[e("td",Ve,[m(e("input",{type:"checkbox","onUpdate:modelValue":s[8]||(s[8]=u=>c.value=u),value:t.id},null,8,Le),[[B,c.value]])]),e("td",Be,[G(n(t.recipient_name),1),s[20]||(s[20]=e("br",null,null,-1)),e("span",De,n(t.recipient_phone),1)]),e("td",{class:"px-3 py-2 whitespace-nowrap max-w-xs overflow-hidden text-ellipsis",title:t.message},n(K(t.message,2)),9,Fe),e("td",$e,[t.status==="sent"?(l(),V(r(W),{key:0,class:"text-green-600 w-4 h-4"})):t.status==="failed"?(l(),V(r(Z),{key:1,class:"text-red-600 w-4 h-4"})):(l(),o("svg",qe,[...s[21]||(s[21]=[e("circle",{cx:"10",cy:"10",r:"8"},null,-1)])])),e("span",Ae,n(t.status),1)]),e("td",Ne,n(t.user?.name||"System"),1),e("td",je,n(new Date(t.sent_at).toLocaleString()),1),e("td",ze,[e("button",{onClick:u=>E(t.id),class:"text-red-600 hover:underline"}," Delete ",8,Te)])]))),128))])])]),r(F).length?(l(),o("div",Ke,[e("nav",Ee,[(l(!0),o(w,null,k(r(F),t=>(l(),o("button",{key:t.url||t.label,innerHTML:t.label,onClick:N(u=>t.url?r(p).get(t.url,{},{preserveScroll:!0,preserveState:!1}):null,["prevent"]),disabled:!t.url,class:"px-3 py-1 border rounded bg-white hover:bg-blue-400"},null,8,He))),128))])])):y("",!0)])):(l(),o("p",Ie,"No SMS messages found."))])]),_:1}))}};export{es as default};
